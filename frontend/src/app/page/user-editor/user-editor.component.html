<div class="container my-5">
  <div class="row">
    <div *ngIf="(user$ | async) as user">
      <main class="d-flex flex-column flex-md-row">
        <aside class="user-data verdana col-md-6">
          <div class="offset-xl-1">
            <h2 class="user-title">
              <fa-icon class="me-3" [icon]="faCircleUser"></fa-icon>{{ user.username }}
            </h2>
            <span class="focused">Joined</span>
            <p>{{ user.joinDate }}</p>
            <span class="focused">Last online</span>
            <p>{{ user.lastOnlineDate }}</p>

            <div class="mb-3">
              <span class="focused">Shop items</span>
              <p class="mb-0">
                <a class="summary__toggle d-flex justify-content-between" data-bs-toggle="collapse" href="#shop-items"
                  role="button" aria-expanded="false" aria-controls="shop-items">
                  <span>Î£ {{ user.shopItems?.length || 0 }}</span>
                  <fa-icon class="summary__collapsed" [icon]="faCircleChevronDown"></fa-icon>
                  <fa-icon class="summary__expanded" [icon]="faCircleChevronUp"></fa-icon>
                </a>
              </p>
              <div class="collapse" id="shop-items">
                <ul class="mb-0 mt-3">
                  <li *ngFor="let index of user.shopItems" class="mb-0 mt-0">{{ index.title }}</li>
                </ul>
              </div>
            </div>

            <div class="mb-3">
              <span class="focused">Scores</span>
              <p class="mb-0">
                <a class="summary__toggle d-flex justify-content-between" data-bs-toggle="collapse" href="#scores"
                  role="button" aria-expanded="false" aria-controls="scores">
                  <span>Summary: {{ user.scores?.length || 0 }}</span>
                  <fa-icon class="summary__collapsed" [icon]="faCircleChevronDown"></fa-icon>
                  <fa-icon class="summary__expanded" [icon]="faCircleChevronUp"></fa-icon>
                </a>
              </p>
              <div class="collapse" id="scores">
                {{ user.scores }}
              </div>
            </div>

            <div class="mb-3">
              <span class="focused">Friends</span>
              <p class="mb-0">
                <a class="summary__toggle d-flex justify-content-between" data-bs-toggle="collapse" href="#friends"
                  role="button" aria-expanded="false" aria-controls="friends">
                  <span>Summary: {{ user.friends?.length || 0 }}</span>
                  <fa-icon class="summary__collapsed" [icon]="faCircleChevronDown"></fa-icon>
                  <fa-icon class="summary__expanded" [icon]="faCircleChevronUp"></fa-icon>
                </a>
              </p>
              <div class="collapse" id="friends">
                {{ user.friends }}
              </div>
            </div>

            <span class="focused">Banned</span>
            <p class="mt-2">
              <input [(ngModel)]="user.banned" (change)="checkValue(user.banned ? 'true' : 'false', user.id)"
                type="checkbox" name="" />
            </p>
          </div>
        </aside>

        <form #userForm="ngForm" (ngSubmit)="onUpdate(userForm, user)"
          class="default-form animate__animated animate__fadeInUp animate__faster col-md-6 col-xl-4 offset-xl-1">

          <!-- <div class="form-group">
            <input [(ngModel)]="user.id" class="form-control" name="id" type="text" disabled>
            <label class="focused form-label">#</label>
          </div> -->
          <div class="form-group">
            <app-floating-label-input
              [(inputModel)]="user.id"
              [type]="'number'"
              [name]="'#'"
              [labelContent]="'id'"
              [disabled]="true"
              [required]="false"
            ></app-floating-label-input>
          </div>

          <!-- <div class="form-group">
            <input #inputRef [(ngModel)]="user.username" class="form-control" name="username" type="text"
              (focus)="usernameFocusToggler($event)" (blur)="usernameFocusToggler($event)">
            <label class="form-label" [class]="usernameClass">Username</label>
          </div> -->
          <div class="form-group">
            <app-floating-label-input
              #usernameInput
              [(inputModel)]="user.username"
              [type]="'text'"
              [name]="'username'"
              [labelContent]="'Username'"
              [pattern]="'^.{3,15}$'"
              [validGuide]="'Atleast 3 characters!'"
              (isValidEvent)="getValidationData($event)"
            ></app-floating-label-input>
          </div>

          <!-- <div class="form-group">
            <input #inputRef [(ngModel)]="user.email" class="form-control" name="email" type="email"
              (focus)="emailFocusToggler($event)" (blur)="emailFocusToggler($event)">
            <label class="form-label" [class]="emailClass">E-mail</label>
          </div> -->
          <div class="form-group">
            <app-floating-label-input
              #emailInput
              [(inputModel)]="user.email"
              [type]="'email'"
              [name]="'email'"
              [labelContent]="'E-mail'"
              [pattern]="'^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$'"
              [validGuide]="'Must be a valid email address!'"
              (isValidEvent)="getValidationData($event)"
            ></app-floating-label-input>
          </div>

          <!-- <div class="form-group">
            <input #inputRef [(ngModel)]="user.coins" class="form-control" name="coins" type="number"
            (focus)="coinsFocusToggler($event)" (blur)="coinsFocusToggler($event)">
            <label class="form-label" [class]="coinsClass">Coins</label>
          </div> -->
          <div class="form-group">
            <app-floating-label-input
              #coinsInput
              [(inputModel)]="user.coins"
              [type]="'number'"
              [name]="'coins'"
              [labelContent]="'Coins'"
              [pattern]="'^(?:0|[1-9][0-9]{0,8})$'"
              [validGuide]="'0 - 999999999'"
              (isValidEvent)="getValidationData($event)"
            ></app-floating-label-input>
          </div>
          <!-- <p class="text-white">
            {{ usernameInput.isValidOut }}
            {{ emailInput.isValidOut }}
            {{ coinsInput.isValidOut }}
          </p> -->

          <!--     --- !!! VISSZA KELL RAKNI !!! ---     -->
          <!-- <div class="select__wrapper form-group mb-0">
            <select #inputRef [(ngModel)]="user.role" class="form-select custom-select col-12" name="role" required
              (focus)="roleFocusToggler($event)" (blur)="roleFocusToggler($event)">
              <option hidden disabled selected value=""></option>
              <option value="player">Player</option>
              <option value="admin">Admin</option>
            </select>
            <label class="form-label w-100 d-flex align-items-end justify-content-end icon-label">
              <fa-icon class="select__icon" [icon]="faSquareCaretDown"></fa-icon>
            </label>
            <label class="form-label" [class]="roleClass">Role</label>
          </div> -->

          <button type="submit" class="game-played btn btn-info col-12 my-3"
            [disabled]="!(usernameInput.isValid&&emailInput.isValid&&coinsInput.isValid)">
            Save changes
          </button>
        </form>
      </main>
    </div>
  </div>
</div>
